---
title: "dbutilties"
output: github_document
---

A set of time and cost (import/compute) saving functions as tools:
  
- **db_histogram** - Calculates the bins of a Histogram inside the database. And by default returns a data frame with the values.  When the **output** argument is changed to **ggplot** the function will return a geom_bar ggplot, which meant for a quick plot view.

- **db_raster** - Groups and aggregates the values of two variables so as to allow a large dataset to be visualized.  When the **output** argument is changed to **ggplot** the function will return a geom_bar ggplot, which meant for a quick plot view.

- **db_map_csv** - Reads the first five rows of a CSV file and builds a *Create Table* statement text that can be run in Hive.  It can also create the list needed to pass in **sparklyr** to avoid mapping each column manually

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, eval = FALSE}
devtools::install_github("edgararuiz/dbutilities")
```

```{r, include = FALSE}
library(dplyr)
library(sparklyr)
library(dbutilities)
library(ggplot2)
library(nycflights13)
```

```{r, eval = FALSE}
library(dplyr)
library(sparklyr)
library(dbutilities)
library(ggplot2)
library(nycflights13)
```


```{r}
conf <- spark_config()
  conf$`sparklyr.shell.driver-memory` <- "16G"
  sc <- spark_connect(master = "local", 
                      version = "2.1.0",
                      config = conf)
```


```{r}
data("flights")
flights <- copy_to(sc, flights, "spark_flights")
```

```{r}
flights %>%
  filter(arr_delay < 100) %>%
  select(distance) %>%
  db_histogram()
```

```{r}
flights %>%
  filter(arr_delay < 100) %>%
  select(arr_delay) %>%
  db_histogram(output = "ggplot")
```
```{r}
flights %>%
  filter(arr_delay < 100) %>%
  select(arr_delay) %>%
  db_histogram(bins = 10,  output = "ggplot")
```


```{r}
flights %>%
  filter(arr_delay < 100) %>%
  select(arr_delay, dep_delay) %>%
  db_raster()
```

```{r}
flights %>%
  filter(arr_delay < 100) %>%
  select(arr_delay, dep_delay) %>%
  db_raster(output = "ggplot")
```
```{r}
flights %>%
  filter(arr_delay < 100) %>%
  select(arr_delay, dep_delay) %>%
  db_raster(resolution = 20, output = "ggplot")
```

```{r}
spark_disconnect(sc)
```
